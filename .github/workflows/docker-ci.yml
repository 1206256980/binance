name: Docker CI/CD

on:
  # å½“æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘æ­¤å·¥ä½œæµ
  push:
    branches: [ main ]

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4

      # 1. ç™»å½•åˆ° Docker Hub
      - name: ğŸ”’ Login to Docker Hub
        uses: docker/login-action@v3
        with:
          # ä» GitHub Secrets è·å–ç”¨æˆ·å
          username: ${{ secrets.DOCKER_USERNAME }}
          # ä» GitHub Secrets è·å–è®¿é—®ä»¤ç‰Œ
          password: ${{ secrets.DOCKER_TOKEN }}

      # 2. è®¾ç½® Docker Buildx æ„å»ºç¯å¢ƒ
      - name: ğŸ› ï¸ Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      # 3. æ„å»ºå¹¶æ¨é€é•œåƒ
      - name: ğŸ—ï¸ Build and Push Docker image
        uses: docker/build-push-action@v5
        with:
          # è®¾ç½®ä¸º trueï¼Œè¡¨ç¤ºæ„å»ºå®Œæˆåç«‹å³æ¨é€åˆ°è¿œç¨‹ä»“åº“
          push: true
          # æ„å»ºçš„ä¸Šä¸‹æ–‡æ˜¯æ•´ä¸ªä»“åº“ï¼ˆå½“å‰ç›®å½•ï¼‰
          context: .
          # æŒ‡å®š Dockerfile çš„è·¯å¾„ï¼ˆå¦‚æœä¸åœ¨æ ¹ç›®å½•ï¼Œè¯·ä¿®æ”¹ï¼‰
          file: ./Dockerfile
          # æŒ‡å®šé•œåƒçš„æ ‡ç­¾ï¼šä½¿ç”¨ç”¨æˆ·å/é•œåƒå:ç‰ˆæœ¬å·
          tags: ${{ secrets.DOCKER_USERNAME }}/binance-toyang:latest